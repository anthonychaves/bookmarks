App server(configure entitymanager) -> spring(get entitymanager from jndi?) -> spring(inject entitymanager into beans?)
Where does persistence.xml fit into this?

Glassfish - configure connection pool, data source
Glassfish - alias data source in sun*....xml
Spring - look up data source via aliased name?  probably not because...
persistence.xml - knows data source name
Spring - just use EntityManager based on persistence unit defined in persistence.xml


git - get last commit details command?
git log --summary -1

OpenJPA - how do we load/update schema based on entity definitions?
- with the MappingTool and its Ant task!

Set up sun-web.xml with persistence unit and persistence context refs.  Use Spring PersistenceAnnotationBeanPostProcessor and reference the contexts defined in sun-web.xml

Blog entry: what's the difference between Spring EntityManager subclass and GlassFish EntityManager implementation and management?  Spring provides a thread-safe subclass or wrapper. How does GlassFish do it?  Is it thread safe?

Video encoding - each process has 2 threads: one for transcode, one to monitor and report to database.

Need JCaptcha for signup and CSRFGuard for CSRF protection.  How do we create an API with CSRFGuard?

Service layer - replace persistence units in controllers with service layer - UserService, BookmarkService

implement "that user name already exists, that email address is already in use"

Is openid.identity permanent?  Does this token change?  Is it ok to use this as unique user id in webapp?

How do we open a new window for authentication instead of using a redirect?

ConsumerManager must be static or singleton - how do we route back to the same one in a cluster?

Error messages for login

Web API access - servlet filter to translate API token into user session, set session/user for rest of the request. Transparent access and use the same API

WebKit page screen shots when adding bookmark

How do we map views <-> xml responses?

Revisit @PersistenceUnit vs. @PersistenceContext annotations
- JTA transactions let us use CMT.  CMT in Spring is invasive to programming model, moreso than UserTransaction API.  
- JTA transactions also let us inject an EntityManager into a bean taken from the current thread.  EntityManager has a cache associated with it.  EntityManager and its cache hang around only for the duration of the transaction.  
- Extended transaction scope is good for stateful session beans - the EntityManager and its cache hang around for the duration of a method spanning business process.  
- So, we're left with a cache that's useful for one thread of execution inside a JTA transaction.  We need a database hit for each EntityManager persistence context cache miss.  We have an empty cache for each thread.  This prevents us from getting stale data since we get it right from the database for every thread.
- But we have to hit the database for each object in each thread.  Doesn't this seem wasteful?
- Shared cache!  
- Can we switch to Hibernate as our JPA provider and slip ehcache in to serve as the shared cache?
- How do we handle evictions?  Is this only a problem when more than one application access our database?

How do I revert a file to its pre-edit state with git?  I do not want to check in a file.  Bad edit.  solution: git checkout -- <files>

@GeneratedValue id won't merge: https://issues.apache.org/jira/browse/OPENJPA-673

Merging User stored in HttpSession - user instance seems like a new instance, not detached.  Need to find by id, then save - I really don't like how this works, but it is what it is.

REST-like api: add servlet filter to look up user and insert into session based on token provided in api call.  return json or xml instead of forwarding to jsp

Go back to userService in BookmarkController.  Return modified user from new addBookmark call. - Done

UUID is 128 bits or 2^128.  hex encoded string: each character is 2^4. 16 hex char representation of the 64 most or least sig bits of a UUID is 2^64 because each char is half a byte.

Next steps: Success page for adding a bookmark from the bookmarklet.
            Login from cookie in servlet filter
            Nested sessions?
            Export bookmarks
